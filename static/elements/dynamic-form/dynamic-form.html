<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="dynamic-form">
    <template>
        <style>
            .form-card {
                width: 100%;
                padding: 16px 36px 46px 36px;
            }
        </style>
        <paper-card heading="Reporte de necesidades" class="form-card">
            <div class="card-content"></div>
            <form is="iron-form"
                  id="reportForm"
                  method="post"
                  action="/por_definir/"
                  content-type="application/json"
                  disableNativeValidationUi>

            </form>
        </paper-card>
    </template>
    <script>
        Polymer({
            is: "dynamic-form",

            properties: {
                metadata: Object,
                fields: {
                    type: Array,
                    value: function () {
                        return [];
                    }
                },
                fieldsMappingGenerators: {
                    type: Object,
                    value: function () {
                        return {
                            'text': 'getTextInput',
                            'option': 'getSelectInput'
                        }
                    }
                },

                fieldsMappingTypes: {
                    type: Object,
                    value: function () {
                        return {
                            'text': 'paper-input',
                            'option': 'paper-dropdown-menu'
                        }
                    }
                },

                formMetadataService: Object
            },

            ready: function () {
                this.getFormMetadata();
            },

            getFormMetadata: function () {
                this.formMetadataService = document.createElement('iron-ajax');
                this.formMetadataService.url = '/test.json';
                this.formMetadataService.handleAs = "json";
                this.appendChild(this.formMetadataService);
                this.formMetadataService.addEventListener(
                        'response', this._setFormMetadata.bind(this));
                this.formMetadataService.generateRequest();
            },

            _setFormMetadata: function (event) {
                this.metadata = event.target.lastResponse;
                this.generateFormFields();
            },

            generateFormFields: function () {
                var fields = this.metadata['fields'];
                for (var i = 0; i < fields.length; i++) {
                    var field = fields[i];
                    var dom_field = this.getDomElementFromField(field);
                    this.$$('#reportForm').appendChild(dom_field);
                    this.fields.push(dom_field);
                }
            },

            getDomElementFromField: function (field) {
                var generator = this.fieldsMappingGenerators[field['field_type']];
                return this[generator](field);
            },

            getTextInput: function (field) {
                var text_input = document.createElement(
                        this.fieldsMappingTypes[field['field_type']]);
                text_input.label = field['field_verbose_name'];

                return text_input;
            },

            getSelectInput: function (field) {
                var select_input = new selectElement(field['options'],field['field_verbose_name']);

          /*      var select_input = document.createElement(
                        this.fieldsMappingTypes[field['field_type']]);
                select_input.label = field['field_verbose_name'];

                var listbox = document.createElement('paper-listbox');
                listbox.setAttribute('class', 'dropdown-content');

                var options = field['options'];
                for (var i = 0; i < options.length; i++) {
                    var item = document.createElement('paper-item');
                    item.textContent = options[i]['verbose'];
                    item.id = options[i]['value'];

                    listbox.appendChild(item);
                }

                select_input.appendChild(listbox);*/
                return select_input;
            }
        })
    </script>
</dom-module>